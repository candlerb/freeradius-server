.\"     # DS - begin display
.de DS
.RS
.nf
.sp
..
.\"     # DE - end display
.de DE
.fi
.RE
.sp
..
.TH rlm_sql 5 "5 February 2004" "" "FreeRADIUS Module"
.SH NAME
rlm_sql \- FreeRADIUS Module
.SH DESCRIPTION
The \fIrlm_sql\fP module provides an SQL interface to retrieve
authorization information and store accounting information.  It can be
used in conjunction with, or in lieu of the files and detail modules.
The SQL module has drivers to support the following SQL databases:
.PP
.DS
.br
     db2
.br
     iodbc
.br
     mysql
.br
     oracle
.br
     postgresql
.br
     sybase
.br
     unixodbc
.br
.DE
.PP
Due to the size of the configuration variables, the sql module is
usually configured in a separate file, which is included in the main
radiusd.conf via an include directive.
.PP
The main configuration items to be aware of are:
.IP driver
This variable specifies the driver to be loaded.
.IP server
.IP port
.IP login
.IP password
.IP filename
These specify the servername, username, and password the module will
use to connect to the database. (filename is for sqlite)
.IP radius_db
The name of the database where the radius tables are stored.
.IP deletestatlesessions
This option is set to 'yes' or 'no'.  If you are doing
Simultaneous-Use checking, and this is set to yes, stale sessions (
defined as sessions for which a Stop record was not received ) will be
cleared.
.IP sqltrace
.IP sqltracefile
These two options are useful for debugging sql problems.  If sqltrace
is set to yes, then all sql queries being executed are written to the
file listed in sqltracefile.  This is disabled in normal operation.
.IP num_sql_socks
The number of sql connections to make to the database.
.IP lifetime
.IP max_queries
If set, these limit the amount of time or number of queries for which
a socket may be used, before it's closed and re-opened.
.IP connect_failure_retry_delay
The number of seconds to wait before attempting to reconnect to a
failed database connection.
.IP sql_user_name
This is the definition of the SQL-User-Name attribute.  This is set
once, so that you can use %{SQL-User-Name} in the SQL queries, rather
than the nested username substitution.  This ensures that Username is
parsed consistently for all SQL queries executed.
.IP default_user_profile
This is the default profile name that will be applied to all users if
set.  This is not set by default.
.IP authorize_check_query
.IP authorize_reply_query
These queries are run during the authorization stage to extract the
user authorization information. The row format expected is
(unused,unused,attribute,value,op)
.IP read_groups
If a user is found through the authorize_check_query, whether to continue
searching for groups as well. Defaults to 'yes'.
.IP group_membership_query
The query to run to check user group membership. Each row returned should
have a single column which is the group name.
.IP authorize_group_check_query
.IP authorize_group_reply_query
These queries are run during the authorization stage to extract the
group authorization information. The query may be run multiple times, and
%{Sql-Group} is set to the group name each time. The query should return the
same format rows as authorize_check_query/authorize_reply_query.
.IP accounting_onoff_query
The query to be run when receiving an Accounting On or Accounting Off
packet.
.IP accounting_update_query
.IP accounting_update_query_alt
The query to be run when receiving an Accounting Update packet.  If the
primary query fails, the alt query is run.
.IP accounting_start_query
.IP accounting_start_query_alt
The query to be run when receiving an Accounting Start packet.  If the
primary query fails, the alt query is run.
.IP accounting_stop_query
.IP accounting_stop_query_alt
The query to be run when receiving an Accounting Stop packet.  If the
primary query fails, the alt query is run.
.IP simul_count_query
The query to be run to return the number simultaneous sessions for the
purposes of limiting Simultaneous Use.
.IP simul_verify_query
The query to return the detail information needed to confirm that all
suspected connected sessions are valid, and are not stale sessions.
.IP postauth_query
The query to run during the post-authentication stage.
.IP sqltrace
Whether to enable logging of SQL queries. Defaults to "no".
.IP sqltracefile
Where to write query trace to.
.IP readclients
.IP nas_query
If readclients is set to 'yes', then nas_query is run once at startup time
to update the clients list. Each row returned is of the form
(unused,name_or_ip,shortname,type,secret,optional_virtual_server)
.IP safe_characters
The set of characters which may be inserted unchanged into SQL queries.
All other characters are replaced by =HH where HH is their ASCII hex
representation. The default set is space plus
@abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789.-_:/
.SH CONFIGURATION
.PP
Due to the size of the configuration for this module, it is not
included in this manual page.  Please review the supplied
configuration files for example queries and configuration details.
.SH SECTIONS
.BR authorization,
.BR accounting,
.BR checksimul,
.BR post-authentication
.PP
.SH FILES
.I /etc/raddb/radiusd.conf,
.I /etc/raddb/sql.conf,
.I /etc/raddb/sql/<DB>/dialup.conf,
.I /etc/raddb/sql/<DB>/schema.sql,
.BR
.PP
.SH "SEE ALSO"
.BR radiusd (8),
.BR radiusd.conf (5),
.SH AUTHORS
Chris Parker, cparker@segv.org
